<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Radiadores Emerson - Cadastro de Servi√ßo</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 flex justify-center items-start min-h-screen p-6">

<div class="bg-white shadow-lg rounded-xl p-8 w-full max-w-5xl">

    <header class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-bold text-gray-800">Gerenciamento de Servi√ßos</h1>
            <p class="text-gray-500">Cadastre, edite, pesquise e visualize todos os servi√ßos.</p>
        </div>
        <a th:href="@{/}" class="text-blue-600 hover:underline font-semibold">&laquo; Voltar ao Dashboard</a>
    </header>

    <!-- Mensagens de feedback -->
    <div th:if="${mensagemSucesso}" class="bg-green-100 border border-green-300 text-green-800 px-4 py-2 rounded mb-4" th:text="${mensagemSucesso}"></div>
    <div th:if="${mensagemErro}" class="bg-red-100 border border-red-300 text-red-800 px-4 py-2 rounded mb-4" th:text="${mensagemErro}"></div>

    <!-- Formul√°rio -->
    <form th:action="@{/servicos}" method="post" th:object="${servico}" class="space-y-4">
        <div class="grid md:grid-cols-2 gap-4">
            <div>
                <label for="modelo" class="block text-gray-700 font-medium">Modelo</label>
                <input type="text" id="modelo" th:field="*{modelo}" placeholder="Ex: Gol, Uno"
                       class="w-full mt-1 p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
            </div>
            <div>
                <label for="tipo" class="block text-gray-700 font-medium">Tipo</label>
                <input type="text" id="tipo" th:field="*{tipo}" placeholder="Ex: Radiador, Intercooler"
                       class="w-full mt-1 p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
            <div>
                <label for="servicoExecutado" class="block text-gray-700 font-medium">Servi√ßo Executado</label>
                <input type="text" id="servicoExecutado" th:field="*{servicoExecutado}" placeholder="Ex: Troca, Limpeza"
                       class="w-full mt-1 p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
            </div>
            <div>
                <label for="cliente" class="block text-gray-700 font-medium">Cliente</label>
                <input type="text" id="cliente" th:field="*{cliente}" placeholder="Ex: Nome do cliente"
                       class="w-full mt-1 p-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
            </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
            <div>
                <label for="data" class="block text-gray-700 font-medium">Data</label>
                <input type="date" id="data" th:field="*{data}"
                       class="w-full mt-1 p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
            </div>
            <div>
                <label for="preco" class="block text-gray-700 font-medium">Pre√ßo</label>
                <input type="number" id="preco" th:field="*{preco}" step="0.01" min="0" placeholder="Ex: 150.00"
                       class="w-full mt-1 p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
            </div>
        </div>

        <button type="submit"
                class="bg-blue-600 text-white px-6 py-2 rounded-lg shadow hover:bg-blue-700 transition">
            üíæ Salvar
        </button>
    </form>

    <!-- Relat√≥rios -->
    <div class="mt-10 border-t pt-6">
        <h2 class="text-xl font-semibold text-gray-700 mb-4">Relat√≥rios e Somas</h2>
        <div class="grid md:grid-cols-3 gap-4">

            <!-- Soma do Dia -->
            <form th:action="@{/servicos/soma-dia}" method="get" class="bg-gray-50 p-4 rounded-lg border space-y-2">
                <label for="dataSomaDia" class="font-medium text-gray-700">Consultar Total do Dia</label>
                <input type="date" id="dataSomaDia" name="data"
                       class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                <button type="submit"
                        class="w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition">
                    üìä Ver Total
                </button>
            </form>

            <!-- Relat√≥rio Semanal -->
            <form th:action="@{/servicos/relatorio-semana}" method="get" class="bg-gray-50 p-4 rounded-lg border space-y-2">
                <label for="dataRelatorioSemana" class="font-medium text-gray-700">Relat√≥rio Semanal</label>
                <input type="date" id="dataRelatorioSemana" name="data"
                       class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                <button type="submit"
                        class="w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition">
                    üìë Gerar Relat√≥rio
                </button>
            </form>

            <!-- Relat√≥rio Mensal -->
            <form th:action="@{/servicos/relatorio-mensal}" method="get" class="bg-gray-50 p-4 rounded-lg border space-y-2">
                <label for="dataRelatorioMes" class="font-medium text-gray-700">Relat√≥rio Mensal</label>
                <input type="date" id="dataRelatorioMes" name="data"
                       class="w-full p-2 border rounded-lg focus:ring-2 focus:ring-blue-500" required>
                <button type="submit"
                        class="w-full bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition">
                    üìÖ Gerar Relat√≥rio
                </button>
            </form>
        </div>
    </div>

    <!-- Tabela -->
    <div class="mt-10 border-t pt-6">
        <div class="flex justify-between items-center mb-4">
            <h2 class="text-xl font-semibold text-gray-700">Servi√ßos Cadastrados</h2>
            <!-- Formul√°rio de Pesquisa -->
            <form th:action="@{/servicos}" method="get" class="flex items-center space-x-2">
                <input type="text" name="termo" placeholder="Pesquisar por modelo, cliente..."
                       th:value="${termo}"
                       class="p-2 border rounded-lg focus:ring-2 focus:ring-blue-500">
                <button type="submit" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition">üîç</button>
                <a th:href="@{/servicos}" class="text-gray-600 hover:text-gray-800 text-sm">Limpar</a>
            </form>
        </div>
    </div>

    <div class="overflow-x-auto mt-4">
        <table class="w-full border-collapse bg-white shadow rounded-lg overflow-hidden">
            <thead>
            <tr class="bg-gray-100 text-left">
                <th class="p-3 border">Modelo</th>
                <th class="p-3 border">Tipo</th>
                <th class="p-3 border">Servi√ßo Executado</th>
                <th class="p-3 border">Cliente</th>
                <th class="p-3 border">Data</th>
                <th class="p-3 border">Pre√ßo</th>
                <th class="p-3 border">A√ß√µes</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="servico : ${servicosPage.content}" class="hover:bg-blue-50 transition">
                <td class="p-3 border" th:text="${servico.modelo}"></td>
                <td class="p-3 border" th:text="${servico.tipo}"></td>
                <td class="p-3 border" th:text="${servico.servicoExecutado}"></td>
                <td class="p-3 border" th:text="${servico.cliente}"></td>
                <td class="p-3 border" th:text="${servico.data != null ? #temporals.format(servico.data, 'dd/MM/yyyy') : ''}"></td>
                <td class="p-3 border" th:text="${servico.preco != null ? 'R$ ' + #numbers.formatDecimal(servico.preco, 1, 'POINT', 2, 'COMMA') : ''}"></td>
                <td class="p-3 border text-center">
                    <div class="flex justify-center items-center space-x-2">
                        <a th:href="@{/servicos/editar/{id}(id=${servico.id})}"
                           class="bg-yellow-500 text-white px-3 py-1 rounded-md hover:bg-yellow-600 transition text-sm">‚úèÔ∏è</a>
                        <form th:action="@{/servicos/deletar/{id}(id=${servico.id})}" method="post" onsubmit="return confirm('Tem certeza que deseja excluir este servi√ßo?');">
                            <button type="submit"
                                    class="bg-red-600 text-white px-3 py-1 rounded-md hover:bg-red-700 transition text-sm">üóëÔ∏è</button>
                        </form>
                    </div>
                </td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Controles de Pagina√ß√£o -->
    <div th:if="${servicosPage.totalPages > 1}" class="flex justify-center items-center space-x-2 mt-8">
        <!-- Bot√£o 'Anterior' -->
        <a th:if="${!servicosPage.first}"
           th:href="@{/servicos(page=${servicosPage.number - 1}, size=${servicosPage.size}, termo=${termo})}"
           class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
            &laquo; Anterior
        </a>

        <!-- N√∫meros das P√°ginas -->
        <th:block th:each="i : ${#numbers.sequence(0, servicosPage.totalPages - 1)}">
            <a th:if="${i == servicosPage.number}"
               class="px-4 py-2 bg-blue-600 text-white font-bold rounded-lg"
               th:text="${i + 1}"></a>
            <a th:if="${i != servicosPage.number}"
               th:href="@{/servicos(page=${i}, size=${servicosPage.size}, termo=${termo})}"
               class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition"
               th:text="${i + 1}"></a>
        </th:block>

        <!-- Bot√£o 'Pr√≥xima' -->
        <a th:if="${!servicosPage.last}"
           th:href="@{/servicos(page=${servicosPage.number + 1}, size=${servicosPage.size}, termo=${termo})}"
           class="px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition">
            Pr√≥xima &raquo;
        </a>
    </div>
</div>

</body>
</html>
